<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>線上點名系統</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f5f5f5; }
    .present { color: green; font-weight: bold; }
    .absent { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>線上點名系統</h1>

  <!-- 簽到區 -->
  <h2>學生簽到</h2>
  <form id="attendanceForm">
    <input type="text" id="studentId" placeholder="學號" required>
    <input type="text" id="name" placeholder="姓名" required>
    <button type="submit">簽到</button>
  </form>
  <pre id="result"></pre>

  <hr>

  <!-- 出缺席清單 -->
  <h2>今天出缺席名單</h2>
  <button onclick="loadReport()">重新整理</button>
  <table id="reportTable">
    <thead>
      <tr>
        <th>學號</th>
        <th>姓名</th>
        <th>狀態</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "https://attendance-app-cv7s.onrender.com";

    // 簽到
    document.getElementById("attendanceForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const studentId = document.getElementById("studentId").value;
      const name = document.getElementById("name").value;

      try {
        const res = await fetch(`${API_URL}/attendance`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ studentId, name })
        });
        const data = await res.json();
        document.getElementById("result").textContent = JSON.stringify(data, null, 2);

        // 簽到後自動刷新名單
        loadReport();
      } catch (err) {
        document.getElementById("result").textContent = "❌ 發生錯誤：" + err;
      }
    });

    // 載入今天名單
    async function loadReport() {
      try {
        const res = await fetch(`${API_URL}/report/today`);
        const data = await res.json();

        const tbody = document.querySelector("#reportTable tbody");
        tbody.innerHTML = "";

        data.forEach(student => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${student.studentId}</td>
            <td>${student.name}</td>
            <td class="${student.status === "出席" ? "present" : "absent"}">
              ${student.status}
            </td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        alert("❌ 無法載入名單：" + err);
      }
    }

    // 頁面一打開就載入名單
    loadReport();
  </script>
</body>
</html>
